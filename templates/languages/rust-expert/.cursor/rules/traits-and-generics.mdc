---
description: Rust Traits and Generics
alwaysApply: false
---

# Rust Traits and Generics

Traits enable abstraction, polymorphism, and code reuse. Combined with generics, they provide zero-cost abstractions.

## Small, Focused Traits

```rust
// Good: Single-purpose
pub trait Validate {
    fn validate(&self) -> Result<(), ValidationError>;
}

// Bad: God trait with too many responsibilities
pub trait Entity {
    fn validate(&self) -> Result<(), Error>;
    fn serialize(&self) -> Vec<u8>;
    fn save(&self, db: &Database) -> Result<(), Error>;
}
```

## Trait Bounds

```rust
// impl Trait for simple cases
fn print_all(items: &[impl Display]) {
    for item in items { println!("{item}"); }
}

// where clauses for complex bounds
fn merge<T, U>(left: T, right: U) -> Merged
where
    T: IntoIterator<Item = Record>,
    T::IntoIter: ExactSizeIterator,
{ ... }
```

## Associated Types vs Generic Parameters

- **Associated types** — one implementation per Self type: `trait Iterator { type Item; }`
- **Generic parameters** — multiple implementations per Self type: `trait Convert<T>`

## Phantom Types (Type-State)

```rust
struct Form<State> { data: FormData, _state: PhantomData<State> }

impl Form<Unvalidated> {
    fn validate(self) -> Result<Form<Validated>, ValidationError> { ... }
}
impl Form<Validated> {
    fn submit(self) -> Result<(), SubmitError> { ... }  // Only validated forms
}
// Form::new(data).submit() — compile error! Must validate first.
```

## Static vs Dynamic Dispatch

```rust
fn process(h: impl Handler) { h.handle(); }  // Static — zero cost, larger binary
fn process(h: &dyn Handler) { h.handle(); }  // Dynamic — vtable, smaller binary
// Use trait objects for heterogeneous collections or runtime-determined types
```

## Anti-Patterns

```rust
// Never: Trait objects everywhere when generics would work
// Never: Overusing generics for single-concrete-type cases
fn process<T: Into<String>>(name: T) { }  // Just take String or &str
// Never: Implementing traits for types you don't own without newtype
```
