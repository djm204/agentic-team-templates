---
description: Kotlin Error Handling
alwaysApply: false
---

# Kotlin Error Handling

Sealed types for expected failures. Exceptions for exceptional conditions. Never swallow errors.

## Sealed Result Types

```kotlin
sealed interface Result<out T> {
  data class Success<T>(val value: T) : Result<T>
  data class Failure(val error: AppError) : Result<Nothing>
}
sealed interface AppError {
  data class NotFound(val entity: String, val id: String) : AppError
  data class Validation(val errors: Map<String, String>) : AppError
  data class Conflict(val message: String) : AppError
}

// Handling in routes
when (val result = userService.register(request)) {
  is Result.Success -> call.respond(HttpStatusCode.Created, result.value)
  is Result.Failure -> when (result.error) {
    is AppError.Validation -> call.respond(HttpStatusCode.BadRequest, result.error)
    is AppError.Conflict -> call.respond(HttpStatusCode.Conflict, result.error)
    is AppError.NotFound -> call.respond(HttpStatusCode.NotFound, result.error)
  }
}
```

## kotlin.Result and runCatching

```kotlin
val displayName = runCatching { fetchUser(id) }
  .map { it.displayName }
  .getOrDefault("Unknown User")
```

## Validation

```kotlin
require(customerId.isNotBlank()) { "customerId must not be blank" }
check(order.status == OrderStatus.PAID) { "Can only ship paid orders" }
val user = requireNotNull(userRepo.findById(id)) { "User $id must exist" }
```

## Exception Best Practices

```kotlin
// Catch specific exceptions, chain cause
try { paymentService.charge(order) }
catch (e: PaymentDeclinedException) {
  return Result.Failure(AppError.PaymentDeclined(e.reason))
}

// Never catch CancellationException without rethrowing
try { suspendingOperation() }
catch (e: CancellationException) { throw e }
catch (e: Exception) { logger.error("Failed", e) }
```

## Anti-Patterns

- Never empty catch blocks — always log or propagate
- Never `catch (e: Throwable)` — catches `OutOfMemoryError`; use `Exception` at most
- Never exceptions for control flow — use `firstOrNull` instead of catching `NoSuchElementException`
