---
description: Kotlin Tooling and Build System
alwaysApply: false
---

# Kotlin Tooling and Build System

Gradle with Kotlin DSL. Static analysis. The full production pipeline.

## Gradle (Kotlin DSL)

```kotlin
plugins {
  kotlin("jvm") version "2.1.0"
  kotlin("plugin.serialization") version "2.1.0"
  id("io.gitlab.arturbosch.detekt") version "1.23.7"
}
kotlin {
  jvmToolchain(21)
  compilerOptions { allWarningsAsErrors = true; freeCompilerArgs.addAll("-Xjsr305=strict") }
}
dependencies {
  implementation("io.ktor:ktor-server-core")
  implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core")
  testImplementation(kotlin("test"))
  testImplementation("io.mockk:mockk")
  testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test")
}
tasks.test { useJUnitPlatform() }
```

## Essential Commands

```bash
./gradlew build          # Full build + tests
./gradlew check          # Tests + static analysis
./gradlew detekt         # Static analysis
./gradlew ktlintFormat   # Auto-format
./gradlew dependencies   # Dependency tree
```

## Detekt

- Configure thresholds: `LongMethod: 30`, `ComplexCondition: 4`, `MaxLineLength: 120`
- Forbid `TODO`/`FIXME` without issue numbers
- Enable `MagicNumber`, `TooGenericExceptionCaught`

## kotlinx.serialization

```kotlin
@Serializable
data class CreateUserRequest(val name: String, val email: String, val role: UserRole = UserRole.USER)
@Serializable
enum class UserRole { USER, ADMIN, VIEWER }
// Compile-time, no reflection — prefer over Jackson for Kotlin projects
```

## Docker

- Multi-stage: `gradle:8-jdk21` build → `eclipse-temurin:21-jre-alpine` runtime
- Non-root user, `-XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0`

## Anti-Patterns

- Never `build.gradle` (Groovy) for Kotlin projects — use `.kts`
- Never skip detekt in CI — static analysis catches real bugs
- Never hardcode versions — use version catalogs (`gradle/libs.versions.toml`)
