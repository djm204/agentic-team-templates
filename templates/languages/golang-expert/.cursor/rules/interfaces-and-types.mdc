---
description: Go Interfaces and Type Design
alwaysApply: false
---

# Go Interfaces and Type Design

Interfaces are implicit. Composition replaces inheritance. Clarity over cleverness.

## Keep Interfaces Small

```go
type Reader interface { Read(p []byte) (n int, err error) }
type Writer interface { Write(p []byte) (n int, err error) }
// Compose: type ReadWriter interface { Reader; Writer }
// Bad: 6-method Repository — split into EntityReader, EntityWriter by consumer need
```

## Define at the Consumer

```go
// handler package defines what it needs
type UserFinder interface { FindByID(ctx context.Context, id string) (*User, error) }
type Handler struct { users UserFinder }
// postgres.UserRepo satisfies it implicitly — no explicit "implements"
```

## Functional Options

```go
type Option func(*Server)
func WithReadTimeout(d time.Duration) Option {
    return func(s *Server) { s.readTimeout = d }
}
func NewServer(addr string, opts ...Option) *Server {
    s := &Server{addr: addr, readTimeout: 30 * time.Second}
    for _, opt := range opts { opt(s) }
    return s
}
```

## Embedding for Composition

```go
type SafeMap struct { mu sync.RWMutex; m map[string]string }
// Don't treat embedding as inheritance — it's delegation
```

## Method Receivers

- **Pointer**: mutates receiver, large struct, or consistency with other methods
- **Value**: small immutable struct (e.g., `time.Time`, `Point`)
- Never mix pointer and value receivers on the same type

## Type Definitions

```go
type UserID string   // Distinct type — prevents mixing with raw strings
type Celsius float64
```

## Generics

```go
func Map[T, U any](s []T, f func(T) U) []U {
    result := make([]U, len(s))
    for i, v := range s { result[i] = f(v) }
    return result
}
// Only use when logic is identical across types. If one type, don't genericize.
```

## Anti-Patterns

- **Never** use `any` parameter when the type is known
- **Never** return interfaces from constructors — return concrete types
- **Never** stutter: `user.UserService` → `user.Service`
