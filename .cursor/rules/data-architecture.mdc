---
description: Data architecture - KV storage schema, type definitions, error handling patterns. Apply when working with data storage or types.
globs:
  - "**/types/**/*"
  - "**/lib/kv/**/*"
  - "**/schemas/**/*"
alwaysApply: false
---

# Data Architecture

## KV Storage Schema

**Namespace**: `portfolio-content`

**Key Pattern**: `{contentType}:{id}`

Examples:
- `"career:hero"`
- `"career:projects:uuid-1"`
- `"case-studies:adr-1"`
- `"about:main"`
- `"tags:all"`

## Type Definitions

```typescript
interface KVContent {
  id: string;
  type: 'career-hero' | 'project' | 'case-study' | 'about' | 'tags';
  content: string; // MDX content
  metadata: {
    createdAt: string; // ISO 8601
    updatedAt: string; // ISO 8601
    author: string; // Always me@davidmendez.dev
    version: number; // Optimistic locking
  };
}

interface Project extends KVContent {
  type: 'project';
  title: string;
  tags: string[];
  metrics: Record<string, string | number>;
  featured: boolean;
}

interface CaseStudy extends KVContent {
  type: 'case-study';
  title: string;
  tldr: string;
  specs: Array<{ label: string; value: string }>;
  order: number; // For "next ADR" feature
}
```

## Type Safety Requirements

- All KV operations return `Result<T, Error>` types
- No throwing exceptions - explicit error handling
- Zod schemas for runtime validation
- TypeScript strict mode for compile-time safety

## Error Handling Pattern

```typescript
type Result<T, E = Error> = 
  | { ok: true; value: T }
  | { ok: false; error: E };

// Example usage
const result = await fetchProject(id);
if (!result.ok) {
  return <ErrorMessage error={result.error} />;
}
const project = result.value;
```
