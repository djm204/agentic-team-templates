---
description: Common coding pitfalls to avoid - client-side trust, state mutation, error swallowing, skipping tests, using any type. Quick reference for code review.
alwaysApply: true
---

# Common Pitfalls to Avoid

## 1. Trusting Client-Side Validation

❌ **Wrong**:

```typescript
// Client validates email is me@davidmendez.dev
// Server assumes it's fine
```

✅ **Right**:

```typescript
// Client validates for UX
// Server validates again and rejects if wrong
const isAuthorized = (email: string): boolean => email === 'me@davidmendez.dev';
```

## 2. Mutating State

❌ **Wrong**:

```typescript
const addTag = (project: Project, tag: string) => {
  project.tags.push(tag); // Mutation!
  return project;
};
```

✅ **Right**:

```typescript
const addTag = (project: Project, tag: string): Project => ({
  ...project,
  tags: [...project.tags, tag],
});
```

## 3. Not Handling Errors

❌ **Wrong**:

```typescript
const data = await fetchProject(id); // Throws on error
```

✅ **Right**:

```typescript
const result = await fetchProject(id);
if (!result.ok) {
  return <ErrorMessage error={result.error} />;
}
const data = result.value;
```

## 4. Skipping Tests

❌ **Wrong**:

```typescript
// TODO: Add tests later
```

✅ **Right**:

```typescript
// Write test first (TDD) or immediately after
describe('addTag', () => {
  it('adds tag without mutating original', () => {
    const original = { tags: ['a'] };
    const result = addTag(original, 'b');
    expect(original.tags).toEqual(['a']);
    expect(result.tags).toEqual(['a', 'b']);
  });
});
```

## 5. Using `any` Type

❌ **Wrong**:

```typescript
const processData = (data: any) => { ... }
```

✅ **Right**:

```typescript
const processData = (data: unknown) => {
  if (!isProject(data)) {
    throw new Error('Invalid data');
  }
  // TypeScript now knows data is Project
};
```
