---
description: Git workflow practices - branching, commits, PRs, safety rules. Apply when performing git operations or reviewing version control decisions.
globs:
  - ".git/**/*"
  - ".github/**/*"
  - ".gitignore"
  - ".gitattributes"
alwaysApply: false
---

# Git Workflow

Universal git practices for maintaining clean, traceable project history.

## Commit Practices

### Small, Meaningful Commits

Commits should be atomic and focused:
- One logical change per commit
- Each commit should compile and pass tests
- Separate refactoring from feature changes
- Separate tests from implementation

**Good commit examples:**
- `feat(auth): add login button component`
- `test(auth): add login button tests`
- `fix(api): handle rate limit errors`
- `refactor(utils): extract date formatting`

**Bad commit examples:**
- `WIP` or `fix stuff`
- `add feature and fix bugs and update tests`
- Giant commits with 50+ file changes

### Commit Message Format (Conventional Commits)

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Types:**
- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation
- `test`: Tests
- `refactor`: Code change that neither fixes a bug nor adds a feature
- `perf`: Performance improvement
- `chore`: Build process or auxiliary tool changes
- `style`: Formatting, missing semicolons, etc. (no code change)
- `ci`: CI configuration changes

**Example:**
```
feat(auth): add OAuth integration

- Implement OAuth callback handler
- Add token validation
- Set secure HTTP-only cookies

Closes #123
```

## Branch Strategy

### Feature Branches

```bash
# Create feature branch from main
git checkout main
git pull origin main
git checkout -b feat/user-authentication

# Work in small commits
git add src/auth/login.ts
git commit -m "feat(auth): add login component"

git add tests/auth/login.test.ts
git commit -m "test(auth): add login component tests"

# Push and create PR
git push origin feat/user-authentication
```

### Branch Naming

- `feat/description` - New features
- `fix/description` - Bug fixes
- `refactor/description` - Code refactoring
- `docs/description` - Documentation updates
- `chore/description` - Maintenance tasks

## Pull Request Guidelines

### Before Creating PR

- [ ] All tests pass locally
- [ ] Code compiles without errors
- [ ] Linting passes
- [ ] Code is formatted
- [ ] Self-review completed

### PR Description Template

```markdown
## Summary
Brief description of changes

## Changes
- Bullet points of specific changes

## Testing
How were these changes tested?

## Checklist
- [ ] Tests added/updated
- [ ] Documentation updated
- [ ] No breaking changes (or documented)
```

## Safety Rules

### Never Do These Without Explicit Permission

- `git push --force` (especially to main/master)
- `git reset --hard`
- `git checkout .` or `git restore .`
- `git clean -f`
- `git branch -D`
- Skip hooks (`--no-verify`)

### Staging Best Practices

- Stage specific files by name rather than `git add -A` or `git add .`
- Review staged changes before committing: `git diff --staged`
- Avoid accidentally staging sensitive files (.env, credentials, etc.)

## Handling Mistakes

### Amending Commits

Only amend the most recent unpushed commit:
```bash
git add forgotten-file.ts
git commit --amend --no-edit
```

### Fixing Pre-Commit Hook Failures

When a pre-commit hook fails:
1. The commit did NOT happen
2. Fix the issue identified by the hook
3. Re-stage the changes
4. Create a NEW commit (don't amend the previous commit)

### Undoing Local Changes

```bash
# Discard changes to a specific file
git checkout -- path/to/file

# Unstage a file (keep changes)
git reset HEAD path/to/file

# Undo last commit (keep changes)
git reset --soft HEAD~1
```
